# Code Rrview

### Code Rrview 개념

- 개발자가 작성한 코드를 다른 사람들이 검토하고 피드백을 전달하며, 다시 작성자가 반영하는 과정

<br>

### Code Rrview 이점

- 서비스의 기술적인 구현 부분에 대해 공유·습득
- 일관된 아키텍처를 유지
- 문제를 해결할 수 있는 새로운 관점을 발견
- 잠재적인 장애·버그를 배포 전에 발견하여 전반적인 서비스 운영 비용 절약

코드 리뷰 프로세스는 팀의 규모, 업무 진행 방식, 회사의 특성에 따라 다양한 방식으로 진행되기 때문에, 코드 리뷰 프로세스를 보는 것은 그 회사의 개발 문화를 이해할 수 있는 힌트가 되기도 합니다.

<br>

### 비동기 커뮤니케이션과 GitHub

- 비동기 커뮤니케이션 : Slack, 메일과 같이 요청에 실시간으로 응답을 요구하지 않는 커뮤니케이션 (vs 동기 커뮤니케이션 : 전화와 회의와 같이 실시간 커뮤니케이션)
- 비동기 커뮤니케이션으로 개인의 업무시간을 존중하고, 자료를 정리하고 소통하므로 불필요한 커뮤니케이션을 줄임
- GitHub Pull Request(이하 PR) 코드 리뷰는 비동기적으로 코드 리뷰 가능
- PR을 통해 리뷰어의 **Approve(승인), Comment(피드백 및 토론), Request Changes(수정 요청) 표현**
- 리뷰 결과에 따라 메인 브랜치에 merge 할 수 있는 자격이 주어지거나, merge를 block 할 수 있는 기능을 제공

<br>


### 뱅크샐러드의 코드 리뷰 문화

- **작은 PR 규칙**
  - 1개의 PR은 1,000  Line을 넘을 수 없음
  - PullRequest, Commit의 단위는 최소의 기능 단위로 세분화
  - 테스트 코드는 Mock json 이 라인 수의 대부분을 차지하므로 제한을 두지 않음
  - PR 관리비용 줄어듦, 잘못된 merger 케이스 줄어듦, PR이 짧으니 리뷰도 빠름 (1~2내 리뷰/리뷰 병목 해소)
- **실험 플랫폼**
  - 모바일 앱에서는 실험군/대조군에 따라 다른 UI 혹은 기능을 제공
  
```
---------------------------------------------------------------
// 실험 플랫폼에 의해 결정된 실험군/대조군에 의해 UI/UX를 결정합니다

if isControlGroup() { // 유저가 대조군에 속하면
    return controlGroupUI() // 기존 UI를 제공하고
} else {
    return treatmentGroupUI() // 실험군인 경우 새로운 UI를 제공합니다
}
---------------------------------------------------------------
```

<br>

![after_experiment_platform](https://user-images.githubusercontent.com/81145387/133078451-5c286e34-281e-43bb-b284-838a1c713618.png)

‘작은 PR’ 과 ‘실험 플랫폼’의 특징을 살려 Git branch 전략을 세우고 배포 복잡도를 최소화했습니다.

<br>

- **저 문맥(Low Context) 커뮤니케이션 지향**
  - 리뷰 요청자는 리뷰어가 사전 지식이 없는 상태에서 리뷰에 참여한다는 가정으로 모든 문맥을 제공
  - 프로젝트 스펙(기획서), 테크 스펙, Figma의 링크 첨부, 변경된 부분, GIF 활용 등 PR 정보 공유하고 리뷰어의 이해를 도움
- **커뮤니케이션 비용을 줄이기 위한 Pn 룰**
  - P1 : 꼭 반영해주세요 (Request changes)
  - P2 : 적극적으로 고려해주세요 (Request changes)
  - P3 : 웬만하면 반영해 주세요 (Comment)
  - P4 : 반영해도 좋고 넘어가도 좋습니다 (Approve)
  - P5 : 그냥 사소한 의견입니다 (Approve)
- **리뷰 우선순위 판단을 돕는 D-n 룰**
  - D-0 (ASAP) : 긴급한 수정사항으로 바로 리뷰해 주세요
  - D-N (Within N days) : Working Day 기준으로 N일 이내에 리뷰해 주세요 (일반적 D-1, 중요도 낮으면 D-3~D-5)
- **코드 스타일**
  - [SwiftFormat](https://github.com/nicklockwood/SwiftFormat) 도입
  - 자동으로 코딩 스타일을 맞춰지는 프로세스
- **유닛 테스트**
  - 개발자의 생산성 향상을 근거로 유닛 테스트만 담당하는 고 사양의 맥프로를 구매하여 Jenkins 를 이용해 CI를 구축
  - GitHub의 Pull Request Opened, Commit Changed를 Trigger로 테스트 코드를 실행하며, 그 결과를 PR 의 status 에 반영하는 과정을 자동화

<br>


### 코드 리뷰에 임하는 자세

- 일관된 아키텍처를 유지하고 있는지
- 다른 해결 방법에 대한 의견 제시
- 버그가 발생할 수 있는 가능성 제시
- 기술적인 지식, 노하우 공유
- 히스토리 전달
- 가독성 리뷰
- 기술부채를 줄이기 위한 리뷰
- **순리** : 개발 기간이 조금 걸리더라도 이상적인 설계대로 개발하는 것

<br>

### 참고자료

- [코드 리뷰 in 뱅크샐러드 개발 문화](https://blog.banksalad.com/tech/banksalad-code-review-culture/)
